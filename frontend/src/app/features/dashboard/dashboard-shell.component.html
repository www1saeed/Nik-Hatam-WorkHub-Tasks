<section
  class="dashboard-shell"
  [class.is-rtl]="(currentLang$ | async) === 'fa'"
  [class.is-ltr]="(currentLang$ | async) !== 'fa'"
  [class.is-collapsed]="isCollapsed"
>
  <aside class="dashboard-shell__sidebar" [class.is-open]="isSidebarOpen">
    <div class="dashboard-shell__sidebar-header">
      <div class="dashboard-shell__sidebar-actions">
        <button
          class="dashboard-shell__collapse"
          type="button"
          (click)="toggleCollapse()"
          [class.is-collapsed]="isCollapsed"
        >
          <i class="pi pi-angle-double-left"></i>
        </button>
        <button class="dashboard-shell__close" type="button" (click)="closeSidebar()">
          <i class="pi pi-times"></i>
        </button>
      </div>
    </div>
    @if (currentUser$ | async; as user) {
      <nav class="dashboard-shell__nav">
        @for (section of getVisibleSections(user); track section.key) {
          <div class="dashboard-shell__group">
            @if (section.labelKey) {
              <button
                type="button"
                class="dashboard-shell__group-toggle"
                (click)="toggleGroup(section.key)"
                [attr.aria-expanded]="!isGroupCollapsed(section.key)"
              >
                <span class="dashboard-shell__group-title">{{ section.labelKey | transloco }}</span>
                <i class="pi pi-angle-down" [class.is-collapsed]="isGroupCollapsed(section.key)"></i>
              </button>
            }
            @if (!isGroupCollapsed(section.key)) {
              @for (item of section.items; track item.route) {
                <a
                  [routerLink]="item.route"
                  routerLinkActive="is-active"
                  [routerLinkActiveOptions]="{ exact: true }"
                  (click)="closeSidebar()"
                  [attr.data-label]="item.labelKey | transloco"
                >
                  <i class="{{ item.icon }}"></i>
                  <span>{{ item.labelKey | transloco }}</span>
                </a>
              }
            }
          </div>
        }
        <div class="dashboard-shell__footer">
          <div class="dashboard-shell__group">
            <button
              type="button"
              class="dashboard-shell__group-toggle"
              (click)="toggleGroup('account')"
              [attr.aria-expanded]="!isGroupCollapsed('account')"
            >
              <span class="dashboard-shell__group-title">{{ 'admin.sidebar.groups.account' | transloco }}</span>
              <i class="pi pi-angle-down" [class.is-collapsed]="isGroupCollapsed('account')"></i>
            </button>
            @if (!isGroupCollapsed('account')) {
              <a href="/profile" (click)="closeSidebar()"
                 [attr.data-label]="'nav.profile' | transloco">
                <i class="pi pi-user"></i>
                <span>{{ 'nav.profile' | transloco }}</span>
              </a>
              <a
                routerLink="/dashboard/notifications"
                routerLinkActive="is-active"
                [routerLinkActiveOptions]="{ exact: true }"
                (click)="closeSidebar()"
                [attr.data-label]="'admin.notifications.menu_label' | transloco"
              >
                <i class="pi pi-bell"></i>
                <span>{{ 'admin.notifications.menu_label' | transloco }}</span>
                @if ((unreadNotifications$ | async); as unreadCount) {
                  @if (unreadCount > 0) {
                    <small class="dashboard-shell__badge">{{ unreadBadgeLabel(unreadCount) }}</small>
                  }
                }
              </a>
              <a href="/" (click)="logout()"
                 [attr.data-label]="'nav.logout' | transloco">
                <i class="pi pi-sign-out"></i>
                <span>{{ 'nav.logout' | transloco }}</span>
              </a>
            }
          </div>
        </div>
      </nav>
    }
  </aside>

  <div class="dashboard-shell__content">
    <div class="dashboard-shell__page">
      <router-outlet />
    </div>
  </div>
</section>
